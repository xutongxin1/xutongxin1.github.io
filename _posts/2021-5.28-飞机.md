# 纯笔记，仅用于工作学习使用，不代表均为正确

三代机的机架对应电机输出的实际控制代码

![image-20210528135355745](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528135355745.png)

在A9中也找到对应的代码但是被注释

![image-20210528135648079](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528135648079.png)

虽然A9有C42机架的残留代码但是并没有ctrl_Attitude_MultiRotor_C42_PWM函数

那么按道理可以直接移植三代机的ctrl_Attitude_MultiRotor_C42_PWM到A9版本？

首先看看三代机的机架控制函数的声明![image-20210528140808374](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528140808374.png)

然后使用switch( Cfg_get_UAVType() )来选择机架对应控制

![image-20210528141130977](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528141130977.png)

A9中函数更名为switch( cfg.UAVType )来选择机型

![image-20210528141452631](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528141452631.png)

并且在

![image-20210528141559469](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528141559469.png)

声明机架，机架后面对应数字就是要在参数里，但是很明显的是这不完全行，比如下面这个声明电机的数量

![image-20210528142630029](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528142630029.png)

但是按道理把还有UAVType引用的地方都改了，应该有机会吧——2021年5月28日14:30:17

飞控控制系统初始化，里面就有根据机型设置初始主通道数目，其中

```c
ReadParam("AC_UAVType", 0, 0, (uint64_t*)uav_type, 0 );
```

读取出了机型

![image-20210528154600353](https://raw.githubusercontent.com/xutongxin1/xutongxin1.github.io/master/asset/%E6%97%A5%E5%BF%97/image-20210528154600353.png)

当我需要为8电机时，很明显需要修改UAV_MainMotorCount——2021年5月29日21:44:15



